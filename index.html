<!doctype html>
<html lang="es">

<head>
    <title>Impresiones 3D</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="shortcut icon" type="image/x-icon" href="ponyo.ico">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <br />
        <div class="jumbotron" style="background-color: rgb(34, 124, 207);">
            <h1 class="display-4">Listado de Modelo 3D</h1>
            <hr />
        </div>
        <br />
        <div class="row">
            <div class="col-lg-8">
                <div class="progress">
                    <div id="bar_progreso" class="progress-bar progress-bar-striped" role="progressbar"
                        aria-valuenow="10" aria-valuemin="0" aria-valuemax="1"></div>
                </div>
                <hr />
                <div id="stl_cont" style="max-height: 700px; height: 700px; margin: auto; width: 80%;"></div>
            </div>

            <div id="div_botones" class="col-lg-4"></div>
        </div>
        <br /><br /><br /><br /><br />


    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
    </script>
    <script src="stl_viewer.min.js"></script>

    <script>
        let listado = [{
                Nombre: "Dado D20",
                Ruta: "./stl/D20.stl",
                GCODE: "./gcode/D20.gcode"
            },
            {
                Nombre: "Base Impresion",
                Ruta: "./stl/Base Impresion.stl",
                GCODE: "./gcode/Base Impresion.gcode"
            },
            {
                Nombre: "Figura All Might",
                Ruta: "./stl/all_might_and_stand.stl",
                GCODE: "./gcode/All_might.gcode"
            }
        ];

        function load_prog(load_status, load_session) {
            var loaded = 0;
            var total = 0;

            Object.keys(load_status).forEach(function (model_id) {
                if (load_status[model_id].load_session == load_session) {
                    loaded += load_status[model_id].loaded;
                    total += load_status[model_id].total;

                    var valor = load_status[model_id].loaded / load_status[model_id].total;
                    valor = valor * 100;
                    $('#bar_progreso').css('width', valor + '%');
                }
            });
        }

        function cargaModelo(ruta) {
            $('#bar_progreso').css('width', '0%');
            stl_viewer.remove_model(1);
            stl_viewer.add_models([{
                id: 1,
                filename: ruta,
                rotationx: -0.5 * 3.1415927,
                color: "#ff9900",
                display: "smooth"
            }]);
        }

        /*window.onload = function () {
            var madeleine = new Madeleine({
                target: 'target',
                data: './stl/all_might_and_stand.stl',
                path: './src'
            });
        };*/

        var stl_viewer = new StlViewer(
            document.getElementById("stl_cont"), {
                loading_progress_callback: load_prog,
                zoom: 80,
                loop: true,

                models: [{
                    id: 1,
                    filename: "./stl/D20.stl",
                    rotationx: -0.5 * 3.1415927,
                    color: "#ff9900",
                    display: "smooth"
                }]
            }
        );

        $(document).ready(function () {
            for (let i = 0; i < listado.length; i += 1) {

                $("#div_botones").append(
                    "<div class='btn-group' role='group' style='padding: 0 !important; width:100%;'>" +
                    "<button type='button' class='btn btn-warning' onclick='cargaModelo(\"" + listado[i]
                    .Ruta + "\");'>" + (i + 1) + ".- " + listado[i].Nombre +
                    "</button>" +
                    "<button type='button' class='btn btn-danger' onclick='window.open(\"" +
                    listado[i]
                    .Ruta +
                    "\");'>STL</button>" +
                    "<button type='button' class='btn btn-success' onclick='window.open(\"" +
                    listado[i]
                    .GCODE +
                    "\");'>GCODE</button>" +

                    "</div><br/><br/>"
                );
            }
        });
    </script>
</body>

</html>style='background-color:transparent;'